// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Agent {
  id            String        @id @default(uuid())
  email         String        @unique
  name          String
  phone         String
  password      String // hashed
  walletBalance Float         @default(0.0)
  accountNumber String? // e.g., "0123456789"
  bankName      String? // e.g., "Wema Bank"
  accountName   String? // e.g., "GLOBO-AGENT-123"
  paystackCode  String? // Paystack customer code
  isApproved    Boolean       @default(false)
  canWithdraw   Boolean       @default(false)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  transactions  Transaction[]
}

model Transaction {
  id           String    @id @default(uuid())
  agentId      String
  agent        Agent     @relation(fields: [agentId], references: [id])
  serviceType  String    // "NIN", "BVN_RETRIEVAL", "CAC", etc.
  amount       Float
  reference    String    @unique
  status       String    @default("pending") // "pending" | "processing" | "completed" | "failed"
  metadata     Json?     // client data (e.g., {nin: "...", fullName: "...", fileUrls: [...]} )
  result       Json?     // admin result: { success: true, message: "...", fileUrls: ["..."] }
  adminNotes   String?   // internal notes (e.g., "Sent to NIMC API")
  adminId      String?   // who processed it (future: admin user model)
  deliveredAt  DateTime? // when marked "completed"
  failedAt     DateTime? // when marked "failed"
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}
